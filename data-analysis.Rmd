---
title: Traffic Data Analysis
author: "Omar ElAzazy, 25-1136"
output: html_document
---

```{r echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(tidyr)
library(corrplot)
```
```{r echo=FALSE}
knitr::opts_chunk$set(cache=TRUE, warning=FALSE, message=FALSE)
```

Reading the data.

```{r}
data <- read.csv(file="~/Desktop/Tools/trafficdata/traffic-data.csv", sep=",")
data %>% summary()
```

The data contains the crawl data, advertisement related columns, the road name, the hour and minute the road was last updated, some other road related columns, the username of the reporter, the full name of the reporter, the hour and minute since the report was made, the comment in the report, and some report related columns.

Let's check the unique value in each column.

```{r}
data %>% sapply(function(x) x %>% unique() %>% length)
```

The advertisement related columns are all constant columns, in addition to some road and report related columns. I think it is safe to drop these constant columns.

```{r}
data <- data[,data %>% sapply(function(x) (x %>% unique() %>% length) != 1)]
```

Let's check the ratio of NAs

```{r}
data %>% is.na() %>% mean()
data %>% sapply(function(x) x %>% is.na() %>% mean())
```

There is a high percentage of NAs in rd.img, rd.rp.img and rd.rp.rpImg. I think it is safe to drop these columns since they are related to images and have high NA percentage.

```{r}
data <- data %>% select(-rd.img, -rd.rp.img, -rd.rp.rpImg)
```

The NAs in rd.rp.fullnm seem to be replacable. One way to do it is to put the username (rd.rp.nm) as a replacement for the missing full name(rd.rp.fullnm).

```{r}
data$rd.rp.fullnm <- data %>% apply(1, function(x){
  x['rd.rp.fullnm'] <- ifelse(is.na(x['rd.rp.fullnm']), x['rd.rp.nm'], x['rd.rp.fullnm'])
})
```

Let's check for duplicate rows in the data

```{r}
data %>% nrow() - data %>% unique() %>% nrow()
```

There aren't identical rows, but the way the data was crawled might cause duplicated rows to be represented differently.

crawl_date is the time the data was crawled, while rd.hr, rd.mn look like the time since the road information was last updated. Similarly, with rd.rp.hr and rd.rp.mn look like the time since the report was created. Let's have a date column for the exact timing of the road update and report creation.

```{r}
data <- data %>% mutate(rd.date = crawl_date %>% strptime("%a %b %e %H:%M:%S UTC %Y") %>% as.POSIXlt(origin="1970-01-01", tz = "UTC")  - rd.hr * 60 * 60 - rd.mn * 60 + 2 * 60 * 60)
data <- data %>% mutate(rd.rp.date = crawl_date %>% strptime("%a %b %e %H:%M:%S UTC %Y") %>% as.POSIXlt(origin="1970-01-01", tz = "UTC") - rd.rp.hr * 60 * 60 - rd.rp.mn * 60 + 2 * 60 * 60)
```

We can now drop columns crawl_date, rd.hr, rd.mn, rd.rp.hr, and rd.rp.mn.

```{r}
data <- data %>% select(-crawl_date, -rd.hr, -rd.mn, -rd.rp.hr, -rd.rp.mn)
```

The data was acquired by crawling the data every 30 minutes. So, there might be no change during this 30 minutes interval and the data remain the same. To check for this we can look at rd.rp.cmid which looks like the comment id. Duplicates in comment id should indicate duplicated reports thus duplicated rows in different representations.

```{r}
data <- data %>% subset(!duplicated(data[,'rd.rp.cmid']))
```

The rd.nm has the format of "area;direction", so let's have this information represented in an easier way.

```{r}
data <- data %>% separate(col = rd.nm, into = c('rd.area', 'rd.from.tmp'), sep=';')
data <- data %>% separate(col = rd.from.tmp, into = c('rd.from', 'rd.to'), sep='To')
```
